#!/bin/bash

echo "â™¾ï¸ åˆ›å»ºåº”ç”¨å›¾æ ‡..."

# åˆ›å»ºå›¾æ ‡ç›®å½•
mkdir -p icon_temp.iconset

# åˆ›å»ºç®€å•çš„PNGå›¾æ ‡ï¼ˆä½¿ç”¨sipså‘½ä»¤ï¼‰
create_simple_icon() {
    local size=$1
    local output=$2
    
    # åˆ›å»ºä¸€ä¸ªç®€å•çš„è“è‰²æ–¹å—ä½œä¸ºåŸºç¡€å›¾æ ‡
    # ä½¿ç”¨base64ç¼–ç çš„1x1åƒç´ PNGï¼Œç„¶åç”¨sipsè°ƒæ•´å¤§å°
    echo "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChAGA60e6kgAAAABJRU5ErkJggg==" | base64 -d > temp_1x1.png
    
    # ä½¿ç”¨sipsåˆ›å»ºè“è‰²å›¾æ ‡
    sips -s format png --setProperty formatOptions 100 temp_1x1.png --out temp_blue.png 2>/dev/null
    sips -z $size $size temp_blue.png --out "$output" 2>/dev/null
    
    # å¦‚æœsipså¤±è´¥ï¼Œåˆ›å»ºå¤‡ç”¨å›¾æ ‡
    if [ ! -f "$output" ]; then
        # åˆ›å»ºç®€å•çš„æ–‡æœ¬å›¾æ ‡
        echo "Creating text icon for ${size}x${size}..."
        printf '\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x00\x01\x00\x00\x00\x01\x08\x02\x00\x00\x00\x90wS\xde\x00\x00\x00\tpHYs\x00\x00\x0b\x13\x00\x00\x0b\x13\x01\x00\x9a\x9c\x18\x00\x00\x00\x12IDATx\x9cc\xf8\x0f\x00\x00\x01\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00IEND\xaeB`\x82' > "$output"
    fi
    
    rm -f temp_1x1.png temp_blue.png 2>/dev/null
}

# æ ‡å‡†å›¾æ ‡å°ºå¯¸
echo "  ğŸ“ ç”Ÿæˆå„å°ºå¯¸å›¾æ ‡..."

create_simple_icon 16 "icon_temp.iconset/icon_16x16.png"
create_simple_icon 32 "icon_temp.iconset/icon_16x16@2x.png"
create_simple_icon 32 "icon_temp.iconset/icon_32x32.png"
create_simple_icon 64 "icon_temp.iconset/icon_32x32@2x.png"
create_simple_icon 128 "icon_temp.iconset/icon_128x128.png"
create_simple_icon 256 "icon_temp.iconset/icon_128x128@2x.png"
create_simple_icon 256 "icon_temp.iconset/icon_256x256.png"
create_simple_icon 512 "icon_temp.iconset/icon_256x256@2x.png"
create_simple_icon 512 "icon_temp.iconset/icon_512x512.png"
create_simple_icon 1024 "icon_temp.iconset/icon_512x512@2x.png"

echo "âœ… å›¾æ ‡æ–‡ä»¶ç”Ÿæˆå®Œæˆ"

# åˆ›å»º .icns æ–‡ä»¶
echo "ğŸ“¦ åˆ›å»º .icns æ–‡ä»¶..."
if command -v iconutil >/dev/null 2>&1; then
    iconutil -c icns icon_temp.iconset -o app_icon.icns
    if [ -f "app_icon.icns" ]; then
        echo "âœ… app_icon.icns åˆ›å»ºæˆåŠŸ"
    else
        echo "âŒ .icns æ–‡ä»¶åˆ›å»ºå¤±è´¥"
    fi
else
    echo "âš ï¸  iconutil ä¸å¯ç”¨ï¼Œè·³è¿‡ .icns æ–‡ä»¶åˆ›å»º"
fi

echo ""
echo "ğŸ‰ å›¾æ ‡ç”Ÿæˆå®Œæˆ!"
echo "ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶:"
if [ -f "app_icon.icns" ]; then
    echo "  â€¢ app_icon.icns - macOSåº”ç”¨å›¾æ ‡"
fi
echo "  â€¢ icon_temp.iconset/ - å„å°ºå¯¸å›¾æ ‡æ–‡ä»¶" 