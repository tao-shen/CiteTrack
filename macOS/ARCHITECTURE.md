# CiteTrack macOS è½¯ä»¶æ¶æ„å›¾

## æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CiteTrack macOS App                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AppDelegate (main.swift)                                      â”‚
â”‚  â”œâ”€ Status Bar Management                                      â”‚
â”‚  â”œâ”€ Menu Management                                            â”‚
â”‚  â”œâ”€ Background Data Collection                                   â”‚
â”‚  â””â”€ Sparkle Auto-Update                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI Layer (Cocoa)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SettingsWindowController                                      â”‚
â”‚  â”œâ”€ General Settings Tab                                       â”‚
â”‚  â”œâ”€ Scholar Management Tab                                     â”‚
â”‚  â””â”€ Data Management Tab                                        â”‚
â”‚                                                                 â”‚
â”‚  ChartsWindowController                                         â”‚
â”‚  â”œâ”€ ModernChartsViewController                                â”‚
â”‚  â”œâ”€ ModernToolbar                                              â”‚
â”‚  â”œâ”€ DashboardView                                              â”‚
â”‚  â””â”€ InsightPanel                                              â”‚
â”‚                                                                 â”‚
â”‚  DataRepairViewController                                      â”‚
â”‚  â””â”€ Data Validation & Repair                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Business Logic Layer                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DataManager (ç»Ÿä¸€æ•°æ®ç®¡ç†)                                     â”‚
â”‚  â”œâ”€ Scholar Management                                         â”‚
â”‚  â”œâ”€ Data Import/Export                                         â”‚
â”‚  â””â”€ iOS Compatibility                                          â”‚
â”‚                                                                 â”‚
â”‚  PreferencesManager                                            â”‚
â”‚  â”œâ”€ App Settings                                               â”‚
â”‚  â”œâ”€ Scholar List                                               â”‚
â”‚  â””â”€ User Preferences                                           â”‚
â”‚                                                                 â”‚
â”‚  GoogleScholarService                                          â”‚
â”‚  â”œâ”€ Scholar ID Validation                                      â”‚
â”‚  â”œâ”€ Web Scraping                                               â”‚
â”‚  â””â”€ Data Parsing                                               â”‚
â”‚                                                                 â”‚
â”‚  CitationHistoryManager                                         â”‚
â”‚  â”œâ”€ History Storage                                             â”‚
â”‚  â”œâ”€ Statistics Calculation                                     â”‚
â”‚  â””â”€ Data Analysis                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Layer                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Core Data Stack                                               â”‚
â”‚  â”œâ”€ CoreDataManager                                            â”‚
â”‚  â”œâ”€ CitationHistoryEntity                                      â”‚
â”‚  â””â”€ Data Migration                                             â”‚
â”‚                                                                 â”‚
â”‚  UserDefaults (Legacy)                                         â”‚
â”‚  â”œâ”€ Scholar List Storage                                       â”‚
â”‚  â””â”€ App Settings                                               â”‚
â”‚                                                                 â”‚
â”‚  iCloud Sync                                                   â”‚
â”‚  â”œâ”€ iCloudSyncManager                                          â”‚
â”‚  â””â”€ CloudKit Integration                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  External Services                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Google Scholar                                                â”‚
â”‚  â”œâ”€ Scholar Profile Pages                                       â”‚
â”‚  â””â”€ Citation Data                                              â”‚
â”‚                                                                 â”‚
â”‚  iCloud                                                         â”‚
â”‚  â”œâ”€ Data Synchronization                                       â”‚
â”‚  â””â”€ Cross-Device Sync                                          â”‚
â”‚                                                                 â”‚
â”‚  Sparkle Framework                                             â”‚
â”‚  â””â”€ Auto-Update System                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®æµå›¾

```
iOS Data Export
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JSON File       â”‚
â”‚ (citation_data) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DataManager     â”‚â”€â”€â”€â–¶â”‚ Scholar Import  â”‚â”€â”€â”€â–¶â”‚ UserDefaults    â”‚
â”‚ .importFromiOS  â”‚    â”‚ .addScholar()   â”‚    â”‚ Storage         â”‚
â”‚ Data()          â”‚    â”‚ .updateScholar()â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚                        â”‚
       â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ History Import  â”‚â”€â”€â”€â–¶â”‚ Core Data       â”‚â”€â”€â”€â–¶â”‚ CitationHistory â”‚
â”‚ .importHistory  â”‚    â”‚ Storage         â”‚    â”‚ Entity          â”‚
â”‚ Data()          â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI Update       â”‚
â”‚ .loadData()     â”‚
â”‚ .reloadData()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…³é”®ç»„ä»¶è¯´æ˜

### 1. AppDelegate (main.swift)
- **èŒè´£**: åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸç®¡ç†
- **åŠŸèƒ½**: 
  - çŠ¶æ€æ ç®¡ç†
  - èœå•æ„å»º
  - åå°æ•°æ®æ”¶é›†
  - è‡ªåŠ¨æ›´æ–°

### 2. DataManager
- **èŒè´£**: ç»Ÿä¸€æ•°æ®ç®¡ç†
- **åŠŸèƒ½**:
  - å­¦è€…æ•°æ®ç®¡ç†
  - iOS æ•°æ®å¯¼å…¥/å¯¼å‡º
  - æ•°æ®æ ¼å¼è½¬æ¢
  - è·¨å¹³å°å…¼å®¹æ€§

### 3. PreferencesManager
- **èŒè´£**: åº”ç”¨è®¾ç½®å’Œå­¦è€…åˆ—è¡¨ç®¡ç†
- **åŠŸèƒ½**:
  - åº”ç”¨åå¥½è®¾ç½®
  - å­¦è€…åˆ—è¡¨å­˜å‚¨
  - ç”¨æˆ·é…ç½®ç®¡ç†

### 4. GoogleScholarService
- **èŒè´£**: Google Scholar æ•°æ®è·å–
- **åŠŸèƒ½**:
  - Scholar ID éªŒè¯
  - ç½‘é¡µæ•°æ®æŠ“å–
  - å¼•ç”¨æ•°æ®è§£æ

### 5. CitationHistoryManager
- **èŒè´£**: å†å²æ•°æ®ç®¡ç†
- **åŠŸèƒ½**:
  - å†å²è®°å½•å­˜å‚¨
  - ç»Ÿè®¡æ•°æ®è®¡ç®—
  - æ•°æ®åˆ†æ

### 6. Core Data Stack
- **èŒè´£**: æ•°æ®æŒä¹…åŒ–
- **åŠŸèƒ½**:
  - æ•°æ®æ¨¡å‹ç®¡ç†
  - æ•°æ®è¿ç§»
  - å…³ç³»ç®¡ç†

## æ•°æ®å¯¼å…¥é—®é¢˜åˆ†æ

### é—®é¢˜æ ¹æº
1. **æ–¹æ³•å¯è§æ€§**: `addScholar` å’Œ `updateScholar` æ–¹æ³•æ²¡æœ‰å£°æ˜ä¸º `public`
2. **æ•°æ®å­˜å‚¨**: å¯¼å…¥çš„æ•°æ®åªä¿å­˜åˆ° `DataManager` çš„ `scholars` æ•°ç»„ï¼Œä½†æ²¡æœ‰åŒæ­¥åˆ° `PreferencesManager`
3. **UI æ›´æ–°**: å¯¼å…¥åæ²¡æœ‰æ­£ç¡®è§¦å‘ UI åˆ·æ–°

### è§£å†³æ–¹æ¡ˆ
1. âœ… ä¿®å¤æ–¹æ³•å¯è§æ€§ï¼ˆå·²å®Œæˆï¼‰
2. ğŸ”„ éœ€è¦åŒæ­¥æ•°æ®åˆ° PreferencesManager
3. ğŸ”„ éœ€è¦è§¦å‘ UI æ›´æ–°é€šçŸ¥

## ä¿®å¤å»ºè®®

### 1. æ•°æ®åŒæ­¥é—®é¢˜
```swift
// åœ¨ DataManager.addScholar() ä¸­æ·»åŠ 
public func addScholar(_ scholar: Scholar) {
    if !scholars.contains(where: { $0.id == scholar.id }) {
        scholars.append(scholar)
        saveScholars()
        
        // åŒæ­¥åˆ° PreferencesManager
        PreferencesManager.shared.addScholar(scholar)
        
        // å‘é€æ•°æ®æ›´æ–°é€šçŸ¥
        NotificationCenter.default.post(name: .scholarsDataUpdated, object: nil)
        
        print("âœ… [DataManager] æ·»åŠ äº†å­¦è€…: \(scholar.name)")
    }
}
```

### 2. UI æ›´æ–°é—®é¢˜
```swift
// åœ¨ SettingsWindowController.importData() ä¸­
DispatchQueue.main.async(qos: .userInitiated) {
    self.showAlert(
        title: "å¯¼å…¥æˆåŠŸ",
        message: "æˆåŠŸå¯¼å…¥ \(result.importedScholars) ä½å­¦è€…å’Œ \(result.importedHistory) æ¡å†å²è®°å½•"
    )
    self.loadData() // é‡æ–°åŠ è½½æ•°æ®
    self.tableView.reloadData() // åˆ·æ–°è¡¨æ ¼
}
```

è¿™ä¸ªæ¶æ„å›¾æ˜¾ç¤ºäº†å®Œæ•´çš„è½¯ä»¶ç»“æ„ï¼Œä»¥åŠæ•°æ®å¯¼å…¥é—®é¢˜çš„æ ¹æœ¬åŸå› å’Œè§£å†³æ–¹æ¡ˆã€‚
