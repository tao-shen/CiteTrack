# ä½¿ç”¨æ–¹æ³•ä¸€ä¿®å¤ App Store æäº¤é—®é¢˜

## ğŸ“‹ å®Œæ•´æ“ä½œæ­¥éª¤

### ç¬¬ 1 æ­¥ï¼šåœ¨ Xcode ä¸­ Archive

1. **æ‰“å¼€ Xcode é¡¹ç›®**
   ```bash
   open /Users/tao.shen/google_scholar_plugin/macOS/CiteTrack_macOS.xcodeproj
   ```

2. **æ¸…ç†æ„å»º**ï¼ˆå¯é€‰ä½†æ¨èï¼‰
   - æŒ‰ `Shift + Cmd + K` æˆ–
   - èœå•ï¼š**Product â†’ Clean Build Folder**

3. **Archive æ„å»º**
   - èœå•ï¼š**Product â†’ Archive**
   - ç­‰å¾…æ„å»ºå®Œæˆï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰
   - Archive å®Œæˆåï¼ŒXcode ä¼šè‡ªåŠ¨æ‰“å¼€ Organizer çª—å£

### ç¬¬ 2 æ­¥ï¼šè¿è¡Œä¿®å¤è„šæœ¬

Archive å®Œæˆåï¼Œ**ä¸è¦ç«‹å³æäº¤**ï¼Œå…ˆè¿è¡Œä¿®å¤è„šæœ¬ï¼š

```bash
cd /Users/tao.shen/google_scholar_plugin/macOS
./scripts/fix_archive_entitlements.sh
```

è„šæœ¬ä¼šï¼š
- âœ… è‡ªåŠ¨æŸ¥æ‰¾æœ€æ–°çš„ Archive
- âœ… æ£€æµ‹ç­¾åèº«ä»½
- âœ… ä¸ºæ‰€æœ‰ Sparkle ç»„ä»¶æ·»åŠ  App Sandbox entitlements
- âœ… éªŒè¯ç­¾åå’Œ entitlements
- âœ… é‡æ–°ç­¾åæ•´ä¸ªåº”ç”¨åŒ…

**å¦‚æœè„šæœ¬æ‰¾ä¸åˆ° Archiveï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šè·¯å¾„ï¼š**
```bash
./scripts/fix_archive_entitlements.sh ~/Library/Developer/Xcode/Archives/YYYY-MM-DD/CiteTrack*.xcarchive
```

### ç¬¬ 3 æ­¥ï¼šéªŒè¯ä¿®å¤

è¿è¡Œè„šæœ¬åï¼Œæ£€æŸ¥è¾“å‡ºã€‚åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… Autoupdate signed and verified
âœ… Updater executable signed and verified
âœ… Updater.app bundle signed and verified
âœ… Downloader executable signed and verified
âœ… Downloader.xpc bundle signed and verified
âœ… Installer executable signed and verified
âœ… Installer.xpc bundle signed and verified
âœ… Sparkle framework components signing complete!
```

**æ‰‹åŠ¨éªŒè¯ï¼ˆå¯é€‰ï¼‰ï¼š**
```bash
# æ‰¾åˆ° Archive è·¯å¾„ï¼ˆè„šæœ¬ä¼šæ˜¾ç¤ºï¼‰
ARCHIVE_PATH="path/to/your.xcarchive"

# æ£€æŸ¥ Autoupdate çš„ entitlements
codesign -d --entitlements - "$ARCHIVE_PATH/Products/Applications/CiteTrack.app/Contents/Frameworks/Sparkle.framework/Versions/B/Autoupdate" | grep -A 1 "app-sandbox"
```

åº”è¯¥çœ‹åˆ°ï¼š
```xml
<key>com.apple.security.app-sandbox</key>
<true/>
```

### ç¬¬ 4 æ­¥ï¼šæäº¤åˆ° App Store

1. **åœ¨ Xcode Organizer ä¸­**ï¼ˆWindow â†’ Organizerï¼‰
   - é€‰æ‹©ä¿®å¤åçš„ Archive
   - ç‚¹å‡» **Distribute App**
   - é€‰æ‹© **App Store Connect**
   - ç‚¹å‡» **Next**

2. **é€‰æ‹©åˆ†å‘é€‰é¡¹**
   - é€‰æ‹© **Upload**ï¼ˆä¸Šä¼ åˆ° App Store Connectï¼‰
   - ç‚¹å‡» **Next**

3. **é€‰æ‹©åˆ†å‘å†…å®¹**
   - ä¿æŒé»˜è®¤é€‰é¡¹
   - ç‚¹å‡» **Next**

4. **å®Œæˆä¸Šä¼ **
   - ç­‰å¾…ä¸Šä¼ å®Œæˆ
   - æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯

### ç¬¬ 5 æ­¥ï¼šå¤„ç† dSYM è­¦å‘Šï¼ˆå¯é€‰ï¼‰

å¦‚æœä»ç„¶æœ‰ dSYM è­¦å‘Šï¼Œå¯ä»¥ï¼š

**é€‰é¡¹ 1ï¼šå¿½ç•¥è­¦å‘Š**
- è¿™äº›è­¦å‘Šé€šå¸¸ä¸ä¼šé˜»æ­¢æäº¤
- App Store å¯èƒ½ä¼šæ¥å—æ²¡æœ‰ç¬¬ä¸‰æ–¹æ¡†æ¶ dSYM çš„åº”ç”¨

**é€‰é¡¹ 2ï¼šä» Sparkle å®˜æ–¹è·å– dSYM**
1. è®¿é—®ï¼šhttps://github.com/sparkle-project/Sparkle/releases
2. æ‰¾åˆ°æ‚¨ä½¿ç”¨çš„ Sparkle ç‰ˆæœ¬
3. ä¸‹è½½å¯¹åº”çš„ dSYM æ–‡ä»¶
4. å°† dSYM æ–‡ä»¶å¤åˆ¶åˆ° Archive çš„ `dSYMs` æ–‡ä»¶å¤¹ä¸­
5. é‡æ–°æäº¤

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šè„šæœ¬æ‰¾ä¸åˆ° Archive

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ‰‹åŠ¨æŒ‡å®š Archive è·¯å¾„
./scripts/fix_archive_entitlements.sh ~/Library/Developer/Xcode/Archives/æœ€æ–°æ—¥æœŸ/CiteTrack*.xcarchive
```

### é—®é¢˜ 2ï¼šç­¾åå¤±è´¥

**å¯èƒ½åŸå› ï¼š**
- æ²¡æœ‰æœ‰æ•ˆçš„ç­¾åèº«ä»½
- Archive ä¸­çš„ç­¾åèº«ä»½ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆï¼š**
1. åœ¨ Xcode ä¸­æ£€æŸ¥ç­¾åè®¾ç½®ï¼š
   - é¡¹ç›® â†’ CiteTrack target â†’ **Signing & Capabilities**
   - ç¡®ä¿é€‰æ‹©äº†æ­£ç¡®çš„ Team å’Œ Provisioning Profile
2. é‡æ–° Archive

### é—®é¢˜ 3ï¼šè„šæœ¬æ‰§è¡Œæƒé™é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
chmod +x /Users/tao.shen/google_scholar_plugin/macOS/scripts/fix_archive_entitlements.sh
```

### é—®é¢˜ 4ï¼šä»ç„¶æœ‰ App Sandbox é”™è¯¯

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] è„šæœ¬æ˜¯å¦æˆåŠŸæ‰§è¡Œï¼Ÿï¼ˆæŸ¥çœ‹è¾“å‡ºï¼‰
- [ ] æ˜¯å¦çœ‹åˆ° "âœ… signed and verified" æ¶ˆæ¯ï¼Ÿ
- [ ] æ˜¯å¦åœ¨ä¿®å¤åé‡æ–°æäº¤äº† Archiveï¼Ÿ

**å¦‚æœä»ç„¶å¤±è´¥ï¼š**
1. æ‰‹åŠ¨éªŒè¯ç­¾åï¼ˆä½¿ç”¨ä¸Šé¢çš„éªŒè¯å‘½ä»¤ï¼‰
2. æ£€æŸ¥ `Sparkle.entitlements` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
3. è€ƒè™‘ä½¿ç”¨æ–¹æ³•äºŒï¼ˆç§»é™¤ Sparkleï¼‰

---

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/tao.shen/google_scholar_plugin/macOS

# 2. è¿è¡Œä¿®å¤è„šæœ¬ï¼ˆè‡ªåŠ¨æŸ¥æ‰¾æœ€æ–° Archiveï¼‰
./scripts/fix_archive_entitlements.sh

# 3. æˆ–è€…æ‰‹åŠ¨æŒ‡å®š Archive è·¯å¾„
./scripts/fix_archive_entitlements.sh ~/Library/Developer/Xcode/Archives/YYYY-MM-DD/CiteTrack*.xcarchive

# 4. éªŒè¯ä¿®å¤ï¼ˆå¯é€‰ï¼‰
ARCHIVE_PATH="path/to/archive"
codesign -d --entitlements - "$ARCHIVE_PATH/Products/Applications/CiteTrack.app/Contents/Frameworks/Sparkle.framework/Versions/B/Autoupdate" | grep app-sandbox
```

---

## âœ… æˆåŠŸæ ‡å¿—

ä¿®å¤æˆåŠŸåï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š
- âœ… è„šæœ¬è¾“å‡ºæ˜¾ç¤ºæ‰€æœ‰ç»„ä»¶éƒ½å·²ç­¾åå’ŒéªŒè¯
- âœ… æäº¤åˆ° App Store æ—¶ä¸å†æœ‰ App Sandbox é”™è¯¯
- âš ï¸ dSYM è­¦å‘Šå¯èƒ½ä»ç„¶å­˜åœ¨ï¼ˆå¯ä»¥å¿½ç•¥æˆ–ä» Sparkle å®˜æ–¹è·å–ï¼‰

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥è„šæœ¬è¾“å‡ºä¸­çš„é”™è¯¯ä¿¡æ¯
2. æŸ¥çœ‹ `FINAL_FIX_INSTRUCTIONS.md` è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯
3. å¦‚æœé—®é¢˜æŒç»­ï¼Œè€ƒè™‘ä½¿ç”¨æ–¹æ³•äºŒï¼ˆç§»é™¤ Sparkleï¼‰

